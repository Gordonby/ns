{
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {}
        ],
        "steps": [
            {
                "name": "lzSettings",
                "label": "Enterprise Scale Company Prefix",
                "subLabel": {
                    "preValidation": "Provide a company prefix for the management group structure that will be created.",
                    "postValidation": "Done"
                },
                "bladeTitle": "Company prefix",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Enterprise-Scale ARM deployment requires access at the tenant root (/) scope. Visit this link to ensure you have the appropriate RBAC permission to complete the deployment",
                            "uri": "https://docs.microsoft.com/azure/role-based-access-control/elevate-access-global-admin"
                        }
                    },
                    {
                        "name": "esMgmtGroup",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Management Group prefix",
                        "toolTip": "Provide a prefix for management group structure, 1-5 characters.",
                        "defaultValue": "",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{1,5}$",
                            "validationMessage": "The prefix must be 1-5 characters."
                        }
                    }   
                ]
            },
            {
                "name": "esSetup",
                "label": "Select Enterprise-Scale setup",
                "subLabel": {
                    "preValidation": "Select the type of initial deployment. Foundation will always be included and ideal for net new deployment/development in Azure without hybrid connectivity requirements. If hybrid connectivity is required for migration scenarios and/or connectivy to on-premises, select eith VWan (Microsoft managed network) or HubSpoke (customer managed network) to deploy the requisite networking setup.",
                    "postValidation": "Done"
                },
                "bladeTitle": "lzSetup",
                "elements": [                                        
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Enterprise-Scale degin principles and implemantation can be adopted by all customer no matter what size and history of thier Azure estate. The customer reference implementations below is targeting the most common customer scenarios for a Enterprise-Scale adoption.",
                            "uri": "https://github.com/Azure/Enterprise-Scale/tree/main/docs/reference"
                        }
                    },
                    {
                        "name": "setup",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Select the initial Enterprise-Scale setup",
                        "defaultValue": "Foundation",
                        "toolTip": "Select the type of initial deployment. Foundation will always be included and ideal for net new deployment/development in Azure without hybrid connectivity requirements. If hybrid connectivity is required for migration scenarios and/or connectivy to on-premises, select eith VWan (Microsoft managed network) or HubSpoke (customer managed network) to deploy the requisite networking setup.",
                        "constraints": {
                            "allowedValues": [
                                {
									"label": "Foundation",
									"value": "Foundation"
								},
                                {
                                    "label": "HubSpoke",
                                    "value": "HubSpoke"
                                },
                                {
                                    "label": "VWAN",
                                    "value": "VWAN"
                                }
                            ]
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "esGoalState",
                "label": "Resource deployments and continous compliance",
                "subLabel": {
                    "preValidation": "Select 'Yes' if goal state should be enforced during deployment. Select 'No' if you want to do it post deployment using Azure Policy.",
                    "postValidation": "Done"
                },
                "bladeTitle": "lzGs",
                "elements": [       
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "If you provide a subscriptionId for management, you can also select the desired resource deployments to ensure monitoring, security, and auditing is enabled for you Enterprise-Scale architecture during the setup",
                            "uri": "https://github.com/Azure/Enterprise-Scale/blob/main/docs/Deploy/ES-schema.md"
                        }
                    },
					{
                        "name": "esMgmtSub",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Enable platform management subscription",
                        "toolTip": "Provide the subscription id of an existing, empty subscription that you want to dedicate for management, which will be moved into the management group for platform management. If you don't want to bring a subscription at this time, leave this parameter empty as is.",
                        "defaultValue": "",
                        "constraints": {
                            "required": false,
                            "regex": "^[a-z0-9A-Z-]{36}$",
                            "validationMessage": "A valid subscription id must contain 36 characters. If you don't want to bring a subscription at this point, leave the parameter completely empty."
                        }
                    },                                 
                    {
                        "name": "esLogAnalytics",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy central Log Analytics workspace and enable platform monitoring for Azure resources",
                        "defaultValue": "No",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
					{
                        "name": "esAsc",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Security Center",
                        "defaultValue": "No",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes, Standard Tier (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "Yes, Free Tier",
                                    "value": "Free"
                                },
								{
									"label": "No",
									"value": "No"
								}
                            ]
                        },
                        "visible": true
                    },
					{
                        "name": "esPrivateEndpoint",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enforce Priavte endpoint for PaaS services deployed into landing zones",
                        "defaultValue": "No",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }							
                            ]
                        },
                        "visible": true
                    },
					{
                        "name": "esAzBackup",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure VMs deployed into landing zones are being backed up",
                        "defaultValue": "No",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will assign policies that will enable backup on VMs that are being deployed.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }							
                            ]
                        },
                        "visible": true
                    }
                ]
            }            			
        ],
        "outputs": {
            "setup": "[steps('esSetup').setup]",
            "managementSubscriptionId": "[steps('esGoalState').esMgmtSub]",
            "enableLogAnalytics": "[steps('esGoalState').esLogAnalytics]",
            "enableAsc": "[steps('esGoalState').esAsc]",
            "enablePrivateEndpoint": "[steps('esGoalState').esPrivateEndpoint]",
            "enableAzBackup": "[steps('esGoalState').esAzBackup]",
            "enterpriseScaleCompanyPrefix": "[steps('lzSettings').esMgmtGroup]"
        }
    }
}